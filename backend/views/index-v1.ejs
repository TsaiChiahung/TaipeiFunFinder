<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å°åŒ—æ‚ åŒ– | TaipeiFunFinder</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<style>
  /* Modal åŸºæœ¬æ¨£å¼ */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #fff;
    padding: 1rem;
    border-radius: 8px;
    max-width: 500px;
    width: 90%;
  }
  .modal-close-btn {
    float: right;
    border: none;
    background: none;
    font-size: 1.2rem;
    cursor: pointer;
  }
  footer {
    text-align: center;
    margin-top: 2rem;
    padding: 1rem;
    color: #6c757d;
  }
</style>

<body class="bg-light">
  <!-- å°è¦½åˆ— -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">å°åŒ—æœ€æ–°æ´»å‹•</a>
    </div>
  </nav>

  <!-- æœå°‹æ¬„ä½ -->
  <div class="container my-4">
    <form class="row g-2" method="GET" action="/search">
      <div class="col-md-3">
        <input type="text" name="category" class="form-control" placeholder="è¼¸å…¥é¡åˆ¥">
      </div>
      <div class="col-md-3">
        <input type="text" name="location" class="form-control" placeholder="è¼¸å…¥åœ°é»">
      </div>
      <div class="col-md-3">
        <input type="date" name="date" class="form-control">
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary w-100">æœå°‹</button>
      </div>
    </form>
  </div>

  <!-- æ´»å‹•åˆ†å€ -->
  <div class="container my-5">
    <h2 class="mb-4">ğŸ“… ä»Šå¤©çš„æ´»å‹•</h2>
    <% if (todayEvents.length === 0) { %>
      <p class="text-muted">ä»Šå¤©æ²’æœ‰æ´»å‹•ã€‚</p>
    <% } else { %>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% todayEvents.forEach(event => { %>
          <%- include("partials/eventCard", { event: event }) %>
        <% }); %>
      </div>
    <% } %>
  </div>

  <div class="container my-5">
    <h2 class="mb-4">ğŸ“… æ˜å¤©çš„æ´»å‹•</h2>
    <% if (tomorrowEvents.length === 0) { %>
      <p class="text-muted">æ˜å¤©æ²’æœ‰æ´»å‹•ã€‚</p>
    <% } else { %>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% tomorrowEvents.forEach(event => { %>
          <%- include("partials/eventCard", { event: event }) %>
        <% }); %>
      </div>
    <% } %>
  </div>

  <div class="container my-5">
    <h2 class="mb-4">ğŸ“… æœ¬é€±æœ«çš„æ´»å‹•</h2>
    <% if (weekendEvents.length === 0) { %>
      <p class="text-muted">æœ¬é€±æœ«æ²’æœ‰æ´»å‹•ã€‚</p>
    <% } else { %>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% weekendEvents.forEach(event => { %>
          <%- include("partials/eventCard", { event: event }) %>
        <% }); %>
      </div>
    <% } %>
  </div>

  <div class="container my-5">
    <h2 class="mb-4">ğŸ“… æœªä¾†æ´»å‹•</h2>
    <% if (futureEvents.length === 0) { %>
      <p class="text-muted">ç›®å‰æ²’æœ‰æœªä¾†æ´»å‹•ã€‚</p>
    <% } else { %>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% futureEvents.forEach(event => { %>
          <%- include("partials/eventCard", { event: event }) %>
        <% }); %>
      </div>
    <% } %>
  </div>

  <div class="container my-5">
    <h2 class="mb-4">ğŸ” å®šæœŸæ´»å‹•</h2>
    <% if (recurringEvents.length === 0) { %>
      <p class="text-muted">ç›®å‰æ²’æœ‰å®šæœŸæ´»å‹•ã€‚</p>
    <% } else { %>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        <% recurringEvents.forEach(event => { %>
          <%- include("partials/eventCard", { event: event }) %>
        <% }); %>
      </div>
    <% } %>
  </div>

  <!-- ç•™è¨€ Modal -->
  <div id="comment-modal" class="modal">
    <div class="modal-content">
      <button class="modal-close-btn">âœ–</button>
      <div id="modal-body"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>æœ¬ç«™ç”± <strong>å°åŒ—æ‚ åŒ–</strong> ç¶­è­·</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // æŒ‰è®š
    document.querySelectorAll(".like-btn").forEach(btn => {
      btn.addEventListener("click", async () => {
        const id = btn.dataset.id;
        const res = await fetch(`/events/${id}/like`, { method: "POST" });
        const data = await res.json();
        btn.querySelector(".like-count").textContent = data.likes;
      });
    });

    // å±•é–‹ç•™è¨€
    document.querySelectorAll(".comment-toggle").forEach(btn => {
      btn.addEventListener("click", () => {
        const box = document.getElementById(`comment-box-${btn.dataset.id}`);
        if (box) box.classList.toggle("d-none");
      });
    });

    // æäº¤ç•™è¨€
    document.querySelectorAll(".comment-form").forEach(form => {
      form.addEventListener("submit", async e => {
        e.preventDefault();
        const id = form.dataset.id;
        const text = form.querySelector("input[name='text']").value;
        const res = await fetch(`/events/${id}/comment`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        const list = form.parentElement.querySelector(".comment-list");
        list.innerHTML = "";
        data.comments.forEach(c => {
          const li = document.createElement("li");
          li.className = "list-group-item py-1";
          li.textContent = c.text;
          list.appendChild(li);
        });
        form.reset();
      });
    });
  });
  </script>
</body>
</html>
